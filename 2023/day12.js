const memoize = (fn) => {
	let cache = {};
	let cachehits = 0;
	let cachemisses = 0;
	return (...args) => {
		let cacheKey = args.map((arg) => arg.join(",")).join("|");
		if (cacheKey in cache) {
			cachehits++;
			console.log("Fetching from cache", cacheKey);
			return cache[cacheKey];
		} else {
			cachemisses++;
			console.log("Calculating result", cacheKey);
			let result = fn(...args);
			cache[cacheKey] = result;
			console.log(cachehits);
			console.log(cachemisses);
			return result;
		}
	};
};

let countSolutions = memoize((chunks, groups) => {
	console.log(`Chunks: ${chunks} Groups:${groups}`);
	if (groups.length == 1) {
		strictChunks = chunks.filter((chunk) => chunk.includes("#"));
		if (strictChunks.length > 1) return 0;
		if (strictChunks.length == 1) {
			return permuteChunk(strictChunks[0], groups[0], true).count;
		}
		let count = 0;
		for (let i = 0; i < chunks.length; i++) {
			const chunk = chunks[i];
			count += permuteChunk(chunk, groups[0], true).count;
		}
		return count;
	}
	if (chunks.length == 0) return 0;

	let permutations = [];
	for (let i = 0; i < chunks.length; i++) {
		const chunk = chunks[i];
		permutations.push(permuteChunk(chunk, groups[0]));
		if (chunk.includes("#")) break;
	}
	// console.log(permutations);
	for (let i = 0; i < permutations.length; i++) {
		let p = permutations[i];
		// if (p.count == 0) ;
		for (let j = 0; j < p.ends.length; j++) {
			let newChunks = chunks.slice(i);
			newChunks[0] = newChunks[0].substring(p.ends[j] + 1);
			if (newChunks[0].length == 0) {
				newChunks = newChunks.slice(1);
			}
			p.counts.push(countSolutions(newChunks, groups.slice(1)));
		}
	}
	// console.log(permutations);
	return permutations.reduce(
		(acc, cur) => acc + cur.counts.reduce((a, c) => a + c, 0),
		0
	);
});

function permuteChunk(chunk, group, isLastGroup) {
	let result = { count: 0, ends: [], counts: [] };

	if (group > chunk.length) return result;
	if (group == chunk.length) {
		result.count = 1;
		result.ends.push(chunk.length);
		return result;
	}
	let arr = chunk.split("");

	for (let i = 0; i <= chunk.length - group; i++) {
		if (
			!(
				(i > 0 && chunk.charAt(i - 1) == "#") ||
				(i < chunk.length - group && chunk.charAt(i + group) == "#") ||
				(arr.findIndex((char) => char == "#") != -1 &&
					arr.findIndex((char) => char == "#") < i) ||
				(isLastGroup && arr.lastIndexOf("#") > i + group)
			)
		) {
			result.count++;
			result.ends.push(i + group);
		}
	}
	return result;
}

let input = `???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1`;

let full = `??????#??? 7,1
?#####???????#.. 5,1,1,1
#?#???##??#.?#?#?#? 3,3,1,7
???.?#?????? 1,5,1
?.????????#??? 1,2,2
???#?##?????.#?? 1,8,2
##..#?????## 2,1,3
?###??????..??. 8,1
?.???.???? 1,1,1
.????.??#?#? 1,5
?#??.#??.?. 2,3
??#?##????#???..? 8,1,2,1
.#?.?#??#??.?#?#?.? 1,7,5,1
??.??#.??? 1,1,2
??###??##?????.#? 10,1
???#??###?..#?.?#..# 9,1,1,1
#?.?###?#?#.?.#.?.#? 1,8,1,1,1,1
..?.???#??##???##.?? 1,10
??##.?????#?? 3,1,2
????#?#????#?????.? 1,1,1,8
???.?.#??.? 2,1,1
##?##????? 5,1,1
.?????.???? 3,1,1
?#???.#?.????.? 3,2,1,1,1
?#??##?#?..???#?.?? 8,1,1,2
.??.?.#??????#????. 1,1,11
?.??#????. 1,5
?.???#?.???? 1,1,3
???#???.??.? 4,1
??.#???????...??.? 1,4,1,1,1,1
?#?.??#.?? 3,3,1
??#?#?.????#??#.. 1,1,2,1,5
?#?..??##???##???? 2,11
?##?????#?????? 3,1,3,1,1
.?.?.?##??.??# 1,4,1
??#?..???? 1,3
?#.???#?????#?#??? 2,1,2,4,2,1
#?????..#?#?.????. 3,1,1,1,1,1
?#??.???###?. 3,6
??????.#.?????. 1,1,1,4
.?##?##???? 6,1
??#??#????? 1,1,2
?.?.??#????# 1,1,2,1
.#?????#.? 1,1,2
??.#?.?..#?????? 2,1,1,2,1
????##.?#.?????.?##? 1,2,2,3,1,2
?#.?#??#???...?# 2,1,2,1,1
?#????.??.#????? 4,1,3,1
??#???#??#####????? 4,13
..#?.?.##??##..? 1,1,6,1
.??????.??.?#??#?? 1,1,1,2,4,1
??????#.??#???. 5,4
.????.#??.?#???#?#? 1,3,7
?#.???#???.?????? 2,1,1,2,4
??.?.?#??? 1,2,1
?##?#???#?????? 4,6,2
??????#??#? 1,6
?#?#?????####??#?. 12,1
?.???#?#?????.#? 10,1
#?????..??.#?? 1,1,2,3
???????.#????? 3,2,4,1
#?#.?#?#?##????.#.? 3,8,1
??#?##??####.?.#.?? 12,1,1,1
.?????.#?.??????# 1,1,2,3,1
.###.##?.?#??.?? 3,2,2,2
..???##???##?? 1,2,4
??????#???????##? 4,1,1,1,4
#??.?.??????? 1,1,1,6
?????#?#???????## 3,5,1,3
#??????.???? 1,3,1,1
.?#???.#.?..# 3,1,1,1
??#???#?.?. 5,1
??#???.#??. 3,2
#??.?#.??..##?? 1,2,1,3
#.??.#?.#??.#?????? 1,1,2,2,5,1
????.#.?#? 2,1,2
?##?????##?????# 3,2,8
???#??#????????? 6,4
???#???.?.#? 4,1,2
?????????#?#????# 4,6,1
?#????????#?##?? 2,2,7
.???.?###???? 1,1,7
?##.???.?#?#?????? 2,2,5,4
???..??#??????? 1,1,5,1,2
.?#.#?#??#.??.. 2,3,2,1
#??#???#????##???.? 4,4,1,2,1,1
??##??????? 3,4
??.#.??.#??##???#. 1,1,1,1,6
?????#.?.. 1,1,1
?.????##.??#? 1,4,1,2
?.##??.?????? 1,4,2
????.??#??.? 2,4
.#?###???.????#.???# 6,1,1,1,1,1
.??#???##?????###? 1,1,5,7
???#?????????????? 1,2,1,4,1
?.?#?#??.?.#???? 5,3
??????#.???#??? 4,1,1,2,2
#?????.????##?.????? 1,4,2,3,5
.#??.????.. 2,2,1
.??##?##??? 4,3,1
???????.?#? 4,1,1
??????##????.??? 12,2
??#?#????? 2,1,1
.?????#??#.?.??###?# 3,1,1,1,5
?????#?##?#?? 1,1,5
??#???????#???#?#.?? 16,1
????#?#?#??.???##??? 8,6
???#..#?????? 2,6
???.?????#?#???. 1,1,5,1,2
????.##?.?# 1,3,2
?#???????#????????? 1,1,4,3,1
?????#????.???# 1,4
?#??????????#??? 1,5,4
????.?#?.???#??# 2,2,3,2
#?#??##.??? 7,2
??????#???#?##? 3,3,5
#?.???????.? 1,6,1
?#?#???.??????#? 5,1,4
#????#.?????? 1,1,1,6
.?#???.#??? 4,2
????.??.??.?? 2,2,1,1
??????#?????#? 1,5,1
.?#?#??#??????# 8,2,1
???##?...?.????###? 2,3,1,6
?#???#?#.??????#?? 1,1,1,2,4
?????.?#.???#?#??? 2,1,2,1,4,1
..??????#.???.. 5,2
?.????##?? 1,2,2
??.#?????####.# 1,2,1,4,1
????#????.??.?.???? 6,1,1,1,1
?#?.???#???????##. 1,4,1,1,2
??????????#?????.??? 1,9
..???????..??. 1,4,1
?..??????#..?? 1,6,2
???#??????.?.? 3,1,1,1
?#?###??#?? 7,2
??.?#?.?#??#??. 1,2,7
??.???????. 4,1
??#??#???#? 1,1,2
.??#????## 1,7
#???#??.?.# 5,1
.??#????????#???? 2,2,3
?????.??#?. 1,3
??#?##?.??.????????? 1,1,3,1,2,5
?#??.?#???## 2,2,3
.#?.???????#.??? 1,3,2,1,1
#?#.????.? 1,1,3
?#??#??#??###?????? 13,1,2
..???####.????.? 1,5,1,1
.?#.????????.??#? 1,1,4,2
?.???.?.?? 1,1,1
?#???????.??#??? 3,1,1,3
?.??.??.??##?? 1,2,2
##?#??##???? 4,2,1
??????#???????? 2,1,5
???.???#.??#????.#? 1,1,2,1,4,1
?#?.#...#???? 1,1,2,1
??????..??##??? 3,2,5
?#??#??#??? 1,1,3
.?.????.?#?. 1,1,2,1
.##.???????..#? 2,7,2
?????##.?????. 1,4,5
?#????#??.?#.##.?? 2,1,3,1,2,2
???.?..#?.? 2,2
#.??.???????.??? 1,2,2,1,1
..?###??????#?????? 7,1,2
???#.??????.?? 4,2,1
#?????###.#?..??. 4,3,2,2
??#??#???? 1,1,4
???#??##????.#??? 4,2,1,1
?.##????????? 4,1,1
??#???.#????###?? 4,3,5
??#??.????#.??#?# 4,1,2,1,1
????????#.#???### 2,1,3,2,4
???????#??#???# 1,4,1,1
?#????##?# 3,4
????????.#?? 1,1,1,2
?#??#.??#?#.? 1,1,5,1
#????.?#??.##?????. 3,2,7
?????..?##? 4,4
?..#?????????##?.??? 1,7,1,2,3
#???.#???...? 4,1,1,1
???###??.# 5,1
.#?##???#? 1,2,2
#??????#?.??.?#.??? 1,2,2,2,2,2
???##?????????#??? 5,2,1,2,2
???.????###?##??#. 1,1,6,1
.???#?.?..?? 3,1,1
#???#??#??..??###? 2,1,4,4
.?.?#.????.? 1,1,1,1
..???.#?##.? 2,4
#?#..?#..?????????.? 1,1,1,3,5,1
?.????#.?# 1,4,2
??..??.??.????.# 2,2,2,1,1
?#.#?.?#?? 1,1,1
???#??#.?.? 4,1
..??##?..????..? 4,4,1
?##?.?????#.??# 2,6,1
????.?#???... 1,5
??#.?.?.?????##???# 1,1,1,8
???#.??##???#???#??? 1,1,11
??#?????#?.?.#?? 9,3
?#??#??????#??.?? 2,1,2,3,1
?#?###.???? 5,1
??#..?.??. 1,1,1
.#.??###?????##? 1,4,5
#?#??.???.??? 1,1,3,1
????????.#? 7,2
##?#????????#? 2,4,1,2
#???#?.?????####### 2,2,11
.?????#?.? 1,3
??.?.#??.??????.?? 1,1,2,4,1,1
?????.##?#. 1,4
??#??.??#??#?.#??#? 4,1,5,1,1
????#??#?..??# 6,2
.???????#?#??????#? 2,8,2
#?.??##??.?#?? 2,3,1
?.????????????##? 1,3,1,6
????##???? 1,3
????.##????? 1,5
?.?..???#. 1,1,4
#????#??.?????? 1,1,1,1,6
?#.???##??. 1,3
?????.?.???? 3,1,1
???.??..???? 2,1
??????..???.???? 3,2
????#.??#????#??? 5,3,3,1
?.???#??.???? 2,1
??#?#??.?????.? 4,5
#.?.??.?????????.? 1,3,1
?#???????? 1,3,2
?#???#???#???. 1,4,5
?.????????.# 6,1
??????#?.??#???? 1,1,3,4,1
??#?????#?.? 1,2,1,2
?.?#?#.??# 1,3,3
???????#??? 1,1,2
???.???##??.??.?#??? 1,1,5,1,3,1
??##??#?#??#??? 2,2,2,3
?##?..#.?.?# 3,1,1,1
.#?#?.?.?????.? 3,4
.?##?????#???#?.?. 2,1,1,1,2,1
.?#?##???.#??? 7,2
?????#..#. 3,1,1
.?.?.????#? 1,1,2
?##.?#???#. 2,6
??.??????#?###??. 1,2,2,5
#???????#???????? 1,11,1
???.????#.. 3,4
?.?.???#?..#?.? 1,1,1,2,1
???#???????.?#? 4,3,3
???????#?.?# 3,3,1
.?????#?#?#??#.????# 1,1,1,6,2,1
???????.##?#??#?#??? 1,1,11
?##?????.?????? 7,1,2
??????????????.? 1,1,2,4,1
??.##?????.?#.?? 4,1,1
?..?.??..???? 1,3
?????#????#.?. 1,6
#.??????????????#? 1,12,2
.?.???.???? 2,1
????.?#??.??? 1,1,1,2
??.????#???????. 1,8
...#????????#????. 1,10
.??#?..##? 4,3
????#?.??.?#?????? 1,3,1,1,1,1
????#.???.#? 1,1,1,1
.???.??#???. 1,4
??#?##?????.? 2,7
??#????#??.?. 1,3,1
#?????#.??????#?? 1,1,2,1,4
??????#.?#..???#? 2,3,1,2,1
?.???.??#. 2,1
???#?##??????#.?? 6,1
?#???????#???..?? 3,4,1,1
?##?.#.??? 3,1,2
?#???#?#?#.??..?# 9,2,2
????????#?# 1,2,5
????..???###?? 1,7
?#???.#??.?#?? 5,1,2
.????###?? 1,4
?#?..???#?#???#?# 2,1,7,1
?#??.##????# 2,4,1
.?#.#?#?.?..#????? 2,1,1,1,2,1
???????.###? 1,2,2,3
?.#???????##??#...?? 3,6
??#?##?##????#?.???? 4,7,2
?????????.???.?? 1,4,1,1,1
.#????.??#?.#?? 5,1,1,1
?#?#???.?#??#??###. 1,2,10
?????#?.??# 4,1
?#?????.????.?#???# 3,2,1,1,5
.???????#?##?? 3,6
?.???#???? 1,1,4
??????????? 1,2,1
?##????????#? 6,1,2
?#?.?#???? 3,2,1
?##?###????????? 9,3
?????.??#?##?? 2,8
??#?#?#?????.? 10,1
??.?..?#?#???##? 1,1,1,1,4
.??#????#??#?.?.. 10,1
?????#?#??#??#?##? 3,13
.??????#.???????.? 3,1
?#??.?..?. 3,1
#..?????????? 1,4,2,1
??#??????##.? 4,1,2,1
???##?#.#? 5,2
?##??#.???.????#?? 6,1,1,1,2,1
#??#????..???? 8,1
.#?##?.???#?#?? 4,5
.#????#.?#???. 6,1
.#.??#?????#??#?? 1,3,10
??????##?#??????#? 1,11,1
???##.?..???#???? 3,3
???.?#??##??#?? 1,2,3,1,1
#??.?#????.?# 3,2,3,1
?#?.???????#?. 3,1,5
###?#??????.???? 5,1,1,2
?.#????.?##?? 1,1,4
?????.?#.???????#?# 2,1,2,8,1
??.??##???#.???# 1,4,2,2
?#??????#?????? 2,2,2,1
?????.???? 1,4
????#..??#? 2,1,1
#???.?#.?# 4,2,1
...?...#??##? 1,5
.?????##??##???? 2,3,7
.##??#.??? 2,1,3
???#????##???? 1,10
?.???#?#???# 1,1,7
#..???..???? 1,1,1,2
?#?????#??? 1,1,4
???.?????? 2,1
..??.?#?????.??? 2,3,2
????#?#?#???.? 1,7
.??#??#???##? 6,3
.??#?.??.???????? 1,1,2,1,4
?.?##??..#??.??? 4,2
??.???????#?#. 1,1,5
???????????##???# 1,1,1,9
#.??.?#????##?#? 1,1,2,4,1
????.???#?.??#??## 1,1,2,1,5
?.#???#??? 5,1
???#??#????..? 5,1
??.?#??.?#?# 2,1,3
?.#???#???.???#.? 1,4,4
..##.#???#??? 2,6
??#??.??.?#.?#?.?# 2,1,2,1,1,2
????#?.#??.#??#. 5,2,2,1
????###??#??#?#????? 14,1
???.???#?? 2,1,4
?.????????????.??? 1,1,5,1,3
??#??#??#???..? 7,1
?#??###..?#?#..?? 7,3
#??????.????? 5,2,2
.??#?#??????#.?.?? 12,1,1
???#??#??#.?#?###??? 1,1,1,1,8
??.#??#?###?#?##. 2,1,10
?????#????.#??#?#?# 7,1,8
?##?????.???#??#? 2,7
??#????#?.? 3,2,1
.?#????????.??# 2,3,1,1
??#??????? 1,5,1
??#?#???####????#### 4,12
..??.?#?#.?#? 1,4,2
?????.???##??..#? 1,1,1,4,2
?.#?#????#????#??? 5,10
????????#????.?? 1,8,1,1
??##???#.?? 3,1,2
#???????.#? 1,6,1
#??#??#???##?.#?#. 9,3,1,1
?#??#??.#?#.#?? 6,1,1,1,1
?????????.#??#?? 5,2,3
?.???#.#?##?.?? 1,1,1,2,1
??#.??.?#?? 1,1,2
????????????#. 2,2,1
..????.#??. 1,1,2
?????.?#?#... 1,1,4
.?#??????.?????## 3,1,1,1,2
..?###??#?..??? 7,1
?#??????????????#??? 7,1,2,2,1
#?#??#??#?#?##.?.# 6,1,1,2,1
???..#??#??.#?????? 5,3,1
??...#????#??##?#?? 1,1,11
????##??###?#?????.? 3,10
???????##???.??????? 11,1,2,2
????#??..#?.?? 4,1,2,1
?##????????# 5,3,1
???#.###...??##.?#?# 3,3,1,2,1,1
?.???#?#??#???.??? 1,10,1
?????##?.? 1,5,1
???#?#?#.???# 4,1,1,1
.???#???.??? 1,4,3
?.???.???#??? 1,5,1
??????###???#???.#? 14,1
..???????#??#?##? 2,1,2,6
???#?..??? 4,2
.?.#??????##? 1,3,1,2
?#??#??###?#?? 2,6,1,1
?????#???? 5,2
??#.?.?.#.??.?????? 3,1,1,1,2,1
?????#.?#??? 1,3,4
..??.#????#??? 2,2,2
.?#?#.?#?#??#?#?? 2,1,10
?#??..??#?. 1,1,4
?.??#??#??# 1,1,5
?.??#?????????. 7,1,1
???.???#??? 1,6
???????#.?? 2,3,2
.#?.???????????.? 2,1,3,1,1
???????????????#?# 1,1,2,5,3
.#.??.?????????.??? 1,1,1,7,3
..##?.??????????#.? 3,6,1,1,1
#?#??????#..??? 1,2,1,1,2
##???.?#?##??. 3,1,6
..??#?????#?.. 6,2
.??????#.?????# 1,3,1,4,1
.??#?????#????????? 7,1,1,1,1,1
#??#???.???#?. 1,1,1,3
..??.??????..? 2,3
.???#?.?.????#?????? 4,5
??...????#???#?? 2,1,5
?.??#???.??# 3,1,1,1
#.?#??#?#??#?# 1,1,7,1
.???????##?#??#?# 4,1,4,3
??????????? 2,1
#?.????#???..? 1,2
.#..###??###??##? 1,8,2
????#?#???.##?? 1,4,1,3
????????.##??? 7,5
????.?????????# 1,2,4,1,1
???..#?#??.???? 1,1,4,1,1
??.?#??..???? 1,1,1,3
#?#???#??#??? 7,2,1
???????#???????? 3,6,4
??#????##??#? 3,2,3
?###??#?##????????? 15,1
?#???..?#.. 2,1,1
?#?????.?? 1,1,1
#?????#?????#?#???? 1,1,9,1,1
?#??????#?#???????? 13,1
??##??#?...?#####??? 8,8
.??????????#??#????? 1,1,1,2,1,5
??#??.?#??##???#? 3,6,1
??###????.???? 8,1,1
.??#.?.#????????? 1,1,1,10
????#.?.??#???.? 4,1,6
?????.?#???#? 4,2,2
..???.??.#???#??? 1,1,8
.???#???#?#???? 4,4,3
#?.#?..???#? 1,2,1,1
??#??????#? 1,4
??..?#.#??#? 1,2,1,1
???...?#??#?#?? 1,9
#?.???..?.??. 1,1,1,1
??.??.###?? 1,4
?#???.?????????? 4,9
??#???..????.. 1,4
#???..???.??#.???? 1,1,1,1,2,3
?????.?..????? 1,3
?????##???#???#.?. 7,5
????????#?#????####? 1,17
?##?#??##.?#????###? 9,9
.?????#??#???##?#??. 7,6
?#?#??.??? 3,2
.?..?.??..##.?. 1,1,1,2,1
.??.?????# 1,2,1
???#??????#???... 3,3
.?????????##???.??. 1,5
?#.?#???.#?.?????? 1,2,2,1,1,1
????????.??#.##?#??? 1,1,3,3,7
??????#####? 1,1,6
????#?.?.???. 4,1
??#.?????...???? 2,3,3
.???#????. 2,1
.??????#?#????. 4,4
#.???#??????#?? 1,1,2,6
.??#??.??### 2,1,3
?.?????..?.??#.??? 2,3
??#??##.#?#??#??# 5,1,1,1,2
?#??...?.. 2,1
?#????.?##?????? 4,9
????????###?#????#?# 1,15,1
?????#?.??#????.# 2,3,1,3,1
#????..?#.?#??.# 1,1,2,3,1
?###?###.?????? 3,3,6
?..#?#???.???? 1,6,1
?.?..??##??###?#? 1,10
.???..?#.#?###?#??# 1,1,1,1,8
.??????.????. 3,1
?#.???...#?##?#..? 1,1,6
?????#????.???????#? 1,6,2,4
??????????#????? 1,4,3,1,1
???##?.????#?. 3,2
????..?..??. 1,1,1,1
?#???????. 1,4,1
.???#??##????..??. 1,2,6,1
.??????.?. 2,1,1
?.#?.??.??# 1,2,1
?###?#?##??? 8,2
??#????.#??? 1,5,1,1
##.?????.??#? 2,1,1,2
??#?.?????#? 3,1,2
???.?.?##? 2,1,3
#???????????.?. 1,1,1,4,1
????.??##?.???#. 3,4,1,1
??.???##?? 1,1,5
?.??#??..#? 3,2
.?..#.##????? 1,1,6
???.????????#??.? 1,6,1,1,1
???#??.?#?#? 1,2,1,3
?#???.?.?? 3,1,1
?.?.???##???#??#?? 1,1,10
?#???#?##?##. 1,7
??#??????#.????.?#? 9,1,2
???##????##????.??#? 6,6,3
??#???????#???.??.# 3,1,5,1,1
.????????#?? 2,5
.#?..#.##?#??##??. 1,1,2,1,3,1
?##..?.#????? 2,5
.?.#.##???.? 1,5
?.????????###?##. 6,6
?????##?#. 1,1,4
.??.????#.. 1,1
????...?##??#?##?.? 1,1,10
.???.##???????##?.?? 1,11,1
.??#????#.????.??. 7,3,1
.??.??#?###???##??? 2,11
???#???#?#??#?? 8,3
??#?#???#???#?????. 2,2,1,2,3
?#?#?.?#??#??? 4,1,1,1
.?##?####?##.???? 3,4,2,2
???#??.?.??## 5,1,4
.??.??#??? 2,1,1
?????##..??? 1,4,2
??????..#?#?.? 1,4
???.?#???##..? 1,1,7,1
??.??????.??? 1,3,1,1
????.??.???? 4,1,2,1
????.?????? 1,1,4
???????...??????? 1,3
??#??##?##?###??.. 5,7
??##..#?... 2,2
?????.??..? 5,2,1
?#????????#???#????. 4,12
???##?????..?????# 9,2,1
??#?.??#???.# 1,2,5,1
????..??#? 3,1
#?.#?#???#??? 1,1,1,3
.#????#?#.???## 4,1,1,1,2
?????.???#?. 3,1
?##?.???.?? 4,1,1
?#?#????????#?.??? 4,1,2,1,2
?????.???#??#??## 4,1,2,5
?.?#???..?.##... 4,2
.?????#.?#????#???? 6,4,4
???##?###????#?. 8,3
?#??????.?????#??.. 3,2,8
?????##????# 9,1
??????#..#??? 3,2,2,1
..???.??#?.?????? 1,1,3,6
???#???##.#? 5,2,2
???.??.??????????? 2,1,1,2,1,1
.????????#??.???#? 2,1,4,5
?????.??.? 3,1
??.???????. 1,1,2
?##?#??#??#?? 4,1,1
.??????#??? 1,5
?????...?#?# 1,2,4
?????.#??. 5,2
#.??#???##???#??##?? 1,16
??#??#?.?#.?#?? 5,1,3
???#??.?.#?? 4,1
????#????#?????# 1,3,2,1,1
.#???????.?? 1,1,1,1
#???.?????##?##?#? 1,1,12
????.???##?.? 3,5
?????#????#???# 4,4,2
????#.??????? 2,1,1,1
?#??????#. 2,1,2
????????## 2,3
??????.?????#?# 4,2,1,1
????.??#?? 4,2
???#?#?.#.?.??? 6,1,1,2
#..????..?#?.????# 1,2,1,2,1,1
???????#?#????.? 1,1,5,1,1
#..????#??##???..#?# 1,8,1,1,1
.?.??.??..??? 1,1,2
?.???#.??.. 1,3,1
.?##..?##?. 3,3
.#??#??#????##?#?? 1,1,1,6,1
?.?#?.???#?#??..??# 1,3,6,1
???????????? 4,1,3
..???#??????#???. 5,7
???????#?##? 1,1,1,5
?????#???#??. 1,4,5
.??#???#??? 2,2
?##..?????#? 3,1,2
??.??...#?????#??.? 2,3,4
#?#???#?.? 5,1,1
.????????? 3,2
???????????#???. 2,5,2,1
????.??.?.?????? 2,1,1,1,3
.?????#??.?? 1,4
??????##?#????#.?? 2,7,1,1,1
??#.?#?#?????#?#?# 2,3,2,1,3
???????#??.?????.#? 2,5,2,1,2
.????.?#??#?????? 3,5,5
??#.???.???#??? 1,1,1,1,6
???#???????## 1,1,1,6
#?#.?????. 3,1,2
?.????.?.????. 1,1,1,4
#..?????????? 1,6,1,1
??.?.?..?????..??.?? 2,1
.????##???#?. 1,7
??#??#?.?#?#???? 4,3
???.###???.??#??#? 5,6
#.???.#?#????? 1,1,8
??.??????.#?##??##? 3,9
???????????#????? 2,3,2,1
?##.?????##??#?.#?#. 3,1,6,1,1,1
#?.#?????#.#???????? 2,1,4,1,4,1
??????...?# 1,2,1
#??????##??????.#.#. 1,8,1,1,1
?????.????#? 5,5
..??#.??.?????. 2,1
??????#??.???? 5,2
??##?#?..?????##??? 7,1,1,2
#.??#?#???????##??? 1,4,7,1
?#??#??.????. 1,2,2
.#???.?#?#???????? 1,1,1,7
??????.??#? 3,1,2
#??.?.?#.?#?#??????? 1,2,4,4
???##??#?.??#?????? 1,6,1,1,1,1
.#???##????.???? 9,3
.?????????#?#??? 2,2,6
??#???##??????????? 4,8,3
?.?#????.????????# 1,3,1,1,2,4
???????..?#??..? 1,3
.??.??##?????##.?. 2,3,4,1
.????..?????? 3,4
?????#???.???. 2,3,1,1
?#?????#??? 3,4
?#?#..????????.?.??# 1,1,1,5,1,1
?.?????#.???#? 3,1,2,1
??.?#?#???????#?#? 3,8
???#???#?.#???.#??. 1,1,3,1,2,3
??????##??????#. 1,8,1,1
???#??#?????????. 8,1,1,1
??.????????? 4,3
????????.?. 2,1
??????..?..#?. 4,2
????..??.????????.?? 1,2,1,1,6,1
.????.???.???? 2,1,3,3
??#??#???????.???#. 1,8,1,3
##???????#. 2,3,1
?#?.??#??????.#??? 2,6,3
.??##??.##? 4,2
?##???.??#? 4,1
?#?#?..?#?#?? 4,3
.????#??????..## 6,1,1,2
?##???????????? 5,1,1,1
????.#.???? 2,1,1
???..??#???#?????.? 2,9,1
?????#?????..?. 1,2,2
???.#.???#????? 1,1,1,6
.?..?.##??.??????## 1,2,1,7
#..?#????#?? 1,2,4,1
##??.??#.?????? 4,1,1,1,1
?###??.?#?##?#????# 5,7,3
..#.?##?.. 1,3
?#.#?.??????#??###? 2,1,2,3,3
?????.??.????#???. 4,5
???????#??##??.??#. 3,6,1,2
.?.#?????????##?#.? 1,2,6,1
???#?????????##???.. 6,2,7
?#?##???????.????#?# 4,1,3,3,1,1
.#?????.?????#?##?## 2,1,1,1,4,2
?.?..#????#? 1,6
.#?.?.???????? 1,1,5,1
??#????????#? 6,5
???.?#??#? 3,2,2
??###?#?.?#..? 3,2,1
??#??.?#?. 2,2
?.???.???? 1,1,2
..??#??????#????? 2,9
??.???.????##???.?? 2,3
?#?????.?? 1,1,1
??#.?#?????#?????. 3,5,1,1,1
????????#???????? 1,2,8,1
?#????#.?#. 6,1
???#???#???#?#?## 4,2,7
???.##.????. 2,1
?????#??.??#? 1,5,2
#????????#?.#???? 1,7,1,3
??.#???#.???. 1,5,3
.#??#??#???##?#??? 2,2,1,8
????#..??.????.?? 1,2,2,3,1
#?????.#???#?.#????? 4,1,3,3,1
?????????### 1,1,1,4
?.??..###???# 1,1,4,1
?????#?????#?? 1,2,5
???#??????? 4,2
.???.???#?#?#?? 2,9
?#.?#.??#??#?..?? 2,1,4,2
??????##??..?##?##?? 7,6
###?##...#???.. 6,2,1
????.?#.?#????? 1,1,1,6
???.?.??#?? 3,3
???..#.??#??#???..#? 1,1,1,9,1
???##??.#?.???##..?? 1,2,2,5,1
??????#?.??# 1,5,1,1
#???.????.? 4,2
.?????????.???#?? 3,1,1,2,2
??#???.??? 3,1
.?#?????#?#????.???? 10,2,1
??##???#?##???.. 3,8
??..?????? 1,1,1
????..???#??#?? 1,1,5
#???#.?????#?? 2,1,2,3
#?##????#??.??.? 11,1
?#??.?.?#?#??? 2,6
??..?##?#???.? 1,6,1
?.???????#.?#? 1,8,2
#????#??????##..??. 10,2,1
??.?.#..??????? 2,1,1,1,1
?#?????##?#??#.?## 4,7,3
??#?????#.??#? 5,2,4
??????##?##??#..#?? 2,1,3,5,3
.?????#?#???#?###??? 2,1,1,9
????#?#???###.????? 12,1,1
?.?.?????..?#?????. 2,4
?#???..??#.??#??# 5,1,1,4,1
???.##?????#?.??#? 2,2,1,1,3
?#????#?????#??? 12,1
?#???.#??.. 3,3
?.#??#???????????? 1,9,1
.?.??.??##????.? 2,6
?#?#??#???????.? 1,6,2,1
.#.????#???? 1,1,4
???.#.?.???#?#?## 1,1,9
#?.?##??#??#?????. 2,6,4,1
?.#.???###??#?.#???? 1,1,1,4,1,4
.??###???.??#????? 8,1,1,2
??.??#????#?..?.? 2,1,7,1
???????##.?#?#?#?? 2,4,6
.?..????#?????# 1,11
.??????.??? 1,3,1
#???#?????##??? 12,1
??#?##?????.?# 1,4,3,1
?????.??#?#????#???. 2,13
.#?????#??? 1,1,5
??#?.???#????#??. 1,9
..???#?..?##???. 4,4
#??#.?#?????. 4,3,3
#???#?#?#???.?????? 2,7,5
?#??#???#.???#???? 5,2,3
??????????????? 1,1,7
?.???.???.. 2,1
???#???.??.?????..?? 2,4,2,1,2,1
#.???#.??? 1,3,1
##????????.??? 8,1
??.#???.??? 1,3,1
???###?.??#? 6,1,1
.?????..#.?##??#??? 5,1,2,3,1
?#???????...#.???.#? 4,1,1,1,1
??#.?.#??.?##?#?#?## 1,1,1,1,1,9
#.?#..?#???? 1,1,1,1
??????????#?????? 1,3,6
.?#?#?..?...?#??.??? 5,1,4,1
.#?#???.?.##? 6,1,3
..?#.#??.#?## 2,2,1,2
??#??.???.?#??##??? 5,1,6
????????#????.?? 1,1,6,1
?????##?????????#?. 8,2,1,2
??.##???## 1,3,3
????#?#??????. 5,1,1,3
...????.??.??#.? 1,2
#??.??.?#??????. 2,1,3,1,1
?.#?##????.# 8,1
?#?..?.#???. 3,1,3
??##?????? 2,3
?#??????.?##? 1,2,1,4
#?#?#??.?????# 7,1,1
????????.??#?? 3,1,4
.???????.??????????? 7,2,1,4
???#???????.? 1,8
#????????#??.#.?.??# 1,5,1,1,3
.?..??.??.#####?? 1,1,1,7
#?.???.?????.????### 2,2,1,7
..#.??.?#??? 1,2
??.##??????.?.? 7,1
.??#.?????.?# 3,4,1
??????#??????#??.??? 3,3,1,2,3
?.???.###?.? 1,4
??...##?#?.? 1,4
?.???.#?.. 1,1
#.?###?..?? 1,5,1
?.?#?##?#.?..#??#? 6,1,4
###.?????#? 3,1,3
???#?????##????? 5,5
.??#??#????#.#???#? 4,1,4,3,1
??#????..??#?? 3,1,1,3
???##???##....?## 9,2
??.?##????.?#.?#?? 1,2,1,2,1,1
?####?##?????. 7,1
#??..??????????#?#? 3,14
#?#????..#?#? 3,2,4
???.??#???? 1,3,1
.?#??.?#???????.?? 3,5,1
???..####.?.??? 4,1
.?.??###?#?#??####?? 1,14
??????.???..???? 6,1,1,1,1
??????.?????????? 5,2,2,1
??.#?#????# 1,1,6
???#?.???????.? 2,5,1,1
#????#???? 3,3
????.???#???.?.? 3,1,5,1,1
???#?#???? 1,1,3
????##??????#?? 2,4,1,2,1
.?#?###.??#?#?#?. 6,7
?#.????#???? 1,2,2,1
.??.?.????. 2,1,2
.??..?.?.?###?.??. 1,1,4,1
.???.?##.?? 3,3,2
????????#????? 1,1,2,6
..?.?###.? 1,3
#??#?#.????? 6,1,1
??????##?#??#????.?. 9,5
..???.#?###. 1,5
??.???#??#?#####? 1,11
???.??.##?. 1,1,3
.???#..?????? 2,5
????#.????##????? 1,1,1,5,1
???.?????##??## 1,5,2
??????#????#???? 1,7,1,2
??..?.?#???? 1,1,2,1
????.#?#?????? 1,7,1
?#.????#?#????. 1,5,1,1
????#.#????##???.?.# 3,10,1,1
.?###.#..#??.?? 4,1,3,1
.?.??????#?????##??. 1,13,1
?#??#???????##.#.?? 8,1,3,1,1
?????.????###??? 2,1,4,1
??#??#?#????.????? 7,1,1,1
.?????.?.???.????? 2,1,1,1,2,1
??.???.?#? 1,1,3
.????#???????#? 1,3,3,1
?##??.?????????#.? 4,2,4,1
?.???##??? 1,4
????#?.???#?????? 5,4,4
??????#?????.???.##? 5,1,2
??##??..?.?#? 4,2
??#??##??????????. 1,7,5
??#??.?#..?.##??? 4,2,1,2,1
.??.##?.????????. 1,3,1,1,2
##?.?.?.#???#?.# 3,1,5,1
?##????###???#?????? 2,8
.??###??.? 5,1
?.????#????? 1,8
#..#??.????.#?? 1,3,1,1,1
#?????.?#?.#???? 3,2,3,4
???????.#????? 2,4
????##?????????#?.?? 2,2,2,3,2
?#??.????#????#??? 2,1,10
?.??.##?.?##? 2,3,2
#??????##??#. 1,1,5
?????????? 1,2,1
.?????.??.?. 4,1,1
??????#?#.#?? 1,4,1,1
????????#?##?. 4,7
?????.????.?.#??? 1,1,2,1,4
??#????##. 3,2
#.?#?????# 1,4,1
.????##?????#??#?. 11,2
???#???#????#? 5,6
.?.?????????? 1,1,5
??#?.??.??????? 1,1,5,1
?##????#????#????.?? 2,9,1,1
??????????#??.??? 11,1,1
????#???.???.#??. 1,3
##??.????##? 3,1,2
????????#???#???.? 5,9
??#?????###??#. 2,8,1
?#????#?#?#????.?? 5,1,1,1,2,1
????.??##.?#??#???. 2,4,6
????#????????#???? 1,12,1
?.#???????#??. 1,3
#??.???##??.?#???? 3,2,2,1,3,1
.#?.?.#????.# 1,3,1
??.?????.??. 1,1,2,2
.#?#?????????#?? 1,1,1,7
.?#..?#?#?.? 2,3,1
??????#??#??#??#?. 11,2
#??#?????. 1,3,1
.?#???.#???.#? 4,1,1,1
.??#?#?#######?? 2,11
?..?????###.??.??? 1,2,5,2,1,1
.???#??#????????#? 7,1,1
..??#????#????? 2,7
#.##?????.????##??? 1,7,1,3
?#?#?.??..#??? 3,3
???????????#?#??. 2,5,4
?.??????##.??#. 1,1,2,1,1
..??.?##?????? 1,8
?#.?.??#???? 1,5
??#.??####??? 2,6
?#?#?????.??.#.#.# 6,1,2,1,1,1
??.##??#?#?????????? 2,9,4,1
??#??.???#?#?? 3,1,4
????#???##?? 7,2
.???##?#??..#?.?#?# 4,3,1,2,1
???#?#??.?# 5,1,1
??#?#?????????? 3,1,1,1,3
?#?#.??#??#.?#?????? 1,1,1,2,4,1
?..???.???? 2,2
??#?#.#????.#????? 5,1,3,4
?##???#.?##?.?#? 3,3,3,1
#????????.# 6,1,1
???###.#????#????#?? 6,2,2,5
???????.???????#?# 1,1,2,10
?#???##???#?##???? 1,4,10
???##???.#???#???.? 6,1,1,5
?#?##?..??#?. 6,2
?#???#?.???#??#?? 2,1,8
#..?#?#?..?.?.?.#?? 1,4,1,1,3
.?????.?#.???#?? 1,3,1,1,3
#?#?.?.#?#??? 3,5
.????????#?##????#?? 2,6,4
?..#???#????? 1,1,5,1
???.?.?#?.???#? 3,1,2,1
#??.??????###?.?? 1,1,10,1
.??.##???? 1,5
.?.??.#.??#.? 1,1,1,3
.????#???#??.## 2,3,3,2
?.??????.?##?. 5,4
?##??????.? 3,4
?#?##???#.#? 4,1,1,2
??#?#?#????#??#??? 5,7,3
?#.#????#??#?.?? 2,10,1
#?#????????.??#?? 1,1,2,3,4
.#??#??????.#. 4,4,1
?????.#?## 1,1,4
?#..??#?##. 2,5
?##?..???#?.? 4,1,1
##?.#??#?.? 3,4
#?????#?.?????#? 2,1,3,6
..????##?. 2,2
?#??.????##??#.??? 2,1,1,6,1,1
#???#??#?#.?? 3,2,3,1
??.?...?.??## 1,1,1,3
.??.#??????? 1,1
.??.##????#???##?. 2,6
????###??###??##? 11,3
?#???????#?????? 2,5,2
??????#.?#??.?# 1,3,2,1,1
??##?#????##???.? 1,13
.?#??.?????? 3,2,1
.?#???.?#??? 5,2
??????#?.? 3,2
?????#??????.? 1,2,2,1
.??#?????.?.?? 5,1,1
.??????#.##?#?# 1,1,6
???#??#.##. 2,1,2
####?#?????#???? 8,5
????????????#???? 1,10
???.??..?#???.??##?? 3,1,4,4
????.???.????.? 1,2,1,2
?.?.?????.???# 1,3,4
??#?#?..?#??#??#. 5,7
???.???##?..##?##?.? 5,5
?#??..?###??? 3,4
?????##.?# 2,3,2
?????#??#?.?# 1,1,5,1
#??????###???#?? 10,1
?#?????????????#???. 10,2
.???#??.??? 4,1
..?.?###?##?#?????.. 1,11
?.???????#?##? 1,11
###????#?#?.. 3,6
??####.??#???????# 6,4,4
????.?##????#?? 2,8
?.?#???###?#???. 1,2,1,3,4
??#?.????.??#? 4,1,1,4
?????..?#?? 3,3
?????..??? 3,1
??#????#.?.#???#?.?? 4,1,1,1,2,1
????###??.???##?.?.? 7,1,4,1
?..?.??..?.?.???## 1,2
#?#???????????? 1,6,1,1,1
?..#???#?.? 2,3
.???##?.?#?? 4,3
????##.#??###?? 2,7
??.??????????#???. 2,2,7
???.??.????#????#? 2,10
?#?#??#???????#. 8,1,2
?.#?????#??.?? 1,5
.##???.???#??## 2,1,2,1,2
#???##?#???#?????.?? 17,1`;

let lines = full
	.split("\n")
	.map((line) => line.split(" "))
	.map((line) => [
		line[0] + "?" + line[0] + "?" + line[0] + "?" + line[0] + "?" + line[0],
		line[1] + "," + line[1] + "," + line[1] + "," + line[1] + "," + line[1],
		,
	])
	.map((line) => [
		line[0].split(".").filter((s) => s != ""),
		line[1].split(",").map((n) => Number(n)),
	]);

console.log(lines);

function testLine(line) {
	let d = line.split(" ");
	d[0] = d[0].split(".").filter((s) => s != "");
	d[1] = d[1].split(",").map((n) => Number(n));
	console.log(countSolutions(...d));
}
// testLine("?..?.??..?.?.???## 1,2");
/*
.#####?#?.#.?? 
.#####?#?.?.#? 
.#####?#?.?.?# 
.#####??#.#.?? 
.#####??#.?.#? 
.#####??#.?.?# 
.#####???.#.#? 
.#####???.#.?# 
.?#####?#.#.?? 
.?#####?#.?.#? 
.?#####?#.?.?# 
.?#####??.#.#? 
.?#####??.#.?# 
.??#####?.#.#? 
.??#####?.#.?# 
*/

let results = lines.map((line) => countSolutions(...line));
console.log(results);
console.log(results.reduce((a, c) => a + c));
